{"version":3,"file":"fancy_index.njs","sources":["../../../entrypoints-njs/fancy_index.ts"],"sourcesContent":["import Mark from \"markup-js\";\n\nfunction fancyIndexRender(r: NginxHTTPRequest, templateUrl: string) {\n  r.subrequest(\n    templateUrl,\n    {\n      args: \"\",\n      body: \"\",\n      method: \"GET\",\n    },\n    function (rTmpl) {\n      if (rTmpl.status != 200) {\n        return r.return(rTmpl.status);\n      }\n      const tmpl = rTmpl.responseText;\n      const result = Mark.up(tmpl, {\n        url: r.variables.request_uri.replace(/\\/+/g, \"/\").replace(/\\?.*$/, \"\"),\n      });\n      r.status = 200;\n      r.headersOut[\"Content-Type\"] = \"text/html\";\n      r.sendHeader();\n      r.send(result);\n      r.finish();\n    },\n  );\n}\n\nexport function fancyIndexBeforeRender(r: NginxHTTPRequest) {\n  return fancyIndexRender(r, \"/fancy-index/before.html\");\n}\n\nexport function fancyIndexAfterRender(r: NginxHTTPRequest) {\n  return fancyIndexRender(r, \"/fancy-index/after.html\");\n}\n"],"names":["fancyIndexRender","r","templateUrl","subrequest","args","body","method","rTmpl","status","return","tmpl","responseText","result","Mark","up","url","variables","request_uri","replace","headersOut","sendHeader","send","finish","fancyIndexBeforeRender","fancyIndexAfterRender"],"mappings":";;;;;;;AAEA,SAASA,gBAAgBA,CAACC,CAAmB,EAAEC,WAAmB,EAAA;EAChED,CAAC,CAACE,UAAU,CACVD,WAAW,EACX;IACEE,IAAI,EAAE,EAAE;IACRC,IAAI,EAAE,EAAE;IACRC,MAAM,EAAE;EACT,CAAA,EACD,UAAUC,KAAK,EAAA;IACb,IAAIA,KAAK,CAACC,MAAM,IAAI,GAAG,EAAE;MACvB,OAAOP,CAAC,CAACQ,MAAM,CAACF,KAAK,CAACC,MAAM,CAAC;IAC9B;IACD,MAAME,IAAI,GAAGH,KAAK,CAACI,YAAY;IAC/B,MAAMC,MAAM,GAAGC,SAAI,CAACC,EAAE,CAACJ,IAAI,EAAE;MAC3BK,GAAG,EAAEd,CAAC,CAACe,SAAS,CAACC,WAAW,CAACC,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,OAAO,EAAE,EAAE;IACtE,CAAA,CAAC;IACFjB,CAAC,CAACO,MAAM,GAAG,GAAG;IACdP,CAAC,CAACkB,UAAU,CAAC,cAAc,CAAC,GAAG,WAAW;IAC1ClB,CAAC,CAACmB,UAAU,CAAA,CAAE;IACdnB,CAAC,CAACoB,IAAI,CAACT,MAAM,CAAC;IACdX,CAAC,CAACqB,MAAM,CAAA,CAAE;EACZ,CAAC,CACF;AACH;AAEM,SAAUC,sBAAsBA,CAACtB,CAAmB,EAAA;EACxD,OAAOD,gBAAgB,CAACC,CAAC,EAAE,0BAA0B,CAAC;AACxD;AAEM,SAAUuB,qBAAqBA,CAACvB,CAAmB,EAAA;EACvD,OAAOD,gBAAgB,CAACC,CAAC,EAAE,yBAAyB,CAAC;AACvD"}