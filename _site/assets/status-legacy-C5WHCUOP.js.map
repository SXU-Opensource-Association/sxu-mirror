{"version":3,"file":"status-legacy-C5WHCUOP.js","sources":["../../../_src/components/DiskBar.vue","../../../_src/components/StatusMirrorList.vue","../../../_src/entrypoints/status.ts"],"sourcesContent":["<script setup>\nimport { DISKINFO_JSON_PATH } from \"../lib/consts\";\nimport { ref, onMounted, nextTick } from \"vue\";\n\nconst diskUsages = ref([]);\n\nconst readableFileSize = (size) => {\n  var units = [\"B\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\", \"EB\", \"ZB\", \"YB\"];\n  var i = 0;\n  while (size >= 1024) {\n    size /= 1024;\n    ++i;\n  }\n  return size.toFixed(1) + \" \" + units[i];\n};\n\nonMounted(async () => {\n  const res = await fetch(DISKINFO_JSON_PATH);\n  const d = await res.json();\n  if (!Array.isArray(d)) {\n    d = [d];\n  }\n  diskUsages.value = d.map((disk) => {\n    const percentage = Math.round((disk.used_kb * 100) / disk.total_kb);\n    return {\n      desc: disk.desc,\n      used: readableFileSize(disk.used_kb * 1024),\n      total: readableFileSize(disk.total_kb * 1024),\n      percentage: import.meta.env.LEGACY ? percentage : 0,\n      _percentage: percentage,\n    };\n  });\n  if (!import.meta.env.LEGACY) {\n    await nextTick();\n    await new Promise((resolve) =>\n      setTimeout(() => {\n        resolve();\n      }, 0),\n    );\n    diskUsages.value.forEach((disk) => {\n      disk.percentage = disk._percentage;\n    });\n  }\n});\n</script>\n<template>\n  <div class=\"col-12\" v-if=\"diskUsages.length\"><strong>磁盘占用</strong>:</div>\n  <template v-for=\"disk in diskUsages\">\n    <div class=\"col-1\" v-if=\"disk.desc\">{{ disk.desc }}</div>\n    <div :class=\"['col-' + (disk.desc ? '11' : '12')]\">\n      <div\n        class=\"progress mb-3\"\n        role=\"progressbar\"\n        :aria-valuenow=\"disk.percentage\"\n        aria-valuemin=\"0\"\n        aria-valuemax=\"100\"\n      >\n        <div class=\"progress-bar\" :style=\"{ width: disk.percentage + '%' }\">\n          <strong>{{ disk.used }} / {{ disk.total }}</strong>\n        </div>\n      </div>\n    </div>\n  </template>\n</template>\n","<script setup>\nimport { useMirrorList } from \"../lib/mirrorList\";\nimport { ref, onMounted } from \"vue\";\n\nconst rawMirrorList = useMirrorList();\n\nconst rollMax = 6;\nconst rollCur = ref(0);\n\nconst SCROLL_INTERVAL = 2000;\nconst doScroll = function () {\n  rollCur.value += 1;\n  if (rollCur.value >= rollMax) rollCur.value = 0;\n};\n\nconst freezedRows = ref({});\n\nonMounted(() => {\n  setInterval(doScroll, SCROLL_INTERVAL);\n});\n</script>\n\n<template>\n  <table class=\"table text-break table-hover table-borderless\">\n    <thead>\n      <tr class=\"d-none d-lg-table-row d-b3-table-row\">\n        <th class=\"col-2\">Name</th>\n        <th class=\"col-4\" colspan=\"2\">Last Update</th>\n        <th class=\"col-4\">Upstream</th>\n        <th class=\"col-1\">Status</th>\n        <th class=\"col-1\">Size</th>\n      </tr>\n    </thead>\n    <tbody\n      id=\"mirror-list\"\n      :data-tuna-roll-cur=\"rollCur % rollMax\"\n      :data-tuna-roll-max=\"rollMax\"\n      class=\"table-group-divider\"\n    >\n      <tr\n        v-for=\"mir in rawMirrorList\"\n        :class=\"[\n          'row',\n          'd-lg-table-row',\n          'status-' + mir.status,\n          mir.last_ended_ts == mir.last_update_ts ? 'last-succ' : 'last-fail',\n        ]\"\n        :key=\"mir.name\"\n        :data-tuna-roll-freeze=\"freezedRows[mir.name]\"\n        @mouseenter=\"freezedRows[mir.name] = rollCur\"\n        @mouseleave=\"freezedRows[mir.name] = undefined\"\n      >\n        <th class=\"col-4 d-lg-none d-bs3-def-none text-end\">Name</th>\n        <td class=\"col-8 col-lg-2\">\n          {{ mir.name }}{{ mir.is_master ? \"\" : \" [slave]\" }}\n        </td>\n        <td\n          class=\"col-12 col-lg-4 d-lg-none d-bs3-table-cell d-lg-reduce-table-cell\"\n          colspan=\"2\"\n        >\n          <div class=\"row\">\n            <th class=\"col-4 text-end\">Last Success</th>\n            <td class=\"col-8\">\n              {{ mir.last_update }}, {{ mir.last_update_ago }}\n            </td>\n            <template v-if=\"mir.last_ended_ts != mir.last_update_ts\">\n              <th class=\"col-4 text-end\">Last Attempt</th>\n              <td class=\"col-8\">\n                {{ mir.last_ended }}, {{ mir.last_ended_ago }}\n              </td>\n            </template>\n            <th class=\"col-4 text-end\">Next Sync</th>\n            <td class=\"col-8\" v-if=\"mir.status != 'syncing'\">\n              {{ mir.next_schedule }}, {{ mir.next_schedule_ago }}\n            </td>\n            <td class=\"col-8\" v-else>Syncing Now</td>\n          </div>\n        </td>\n        <td\n          class=\"col-2 rolling-3 d-none d-lg-table-cell d-bs3-none d-reduce-none\"\n        >\n          <div class=\"tuna-roll\">\n            &nbsp;\n            <template v-if=\"mir.last_ended_ts == mir.last_update_ts\">\n              <div data-tuna-roll-seq=\"0 1 2 3\">Last Successful Sync</div>\n            </template>\n            <template v-else>\n              <div data-tuna-roll-seq=\"0 1\">Last Successful Sync</div>\n              <div data-tuna-roll-seq=\"2 3\">Last Attempted Sync</div>\n            </template>\n            <div v-if=\"mir.status == 'syncing'\" data-tuna-roll-seq=\"4 5\">\n              Sync Started\n            </div>\n            <div v-else data-tuna-roll-seq=\"4 5\">Next Scheduled Sync</div>\n          </div>\n        </td>\n        <td\n          class=\"col-2 rolling-6 d-none d-lg-table-cell d-bs3-none d-reduce-none\"\n        >\n          <div class=\"tuna-roll\">\n            &nbsp;\n            <template v-if=\"mir.last_ended_ts == mir.last_update_ts\">\n              <div data-tuna-roll-seq=\"0 1 2 3\">\n                {{ mir.last_update_ago }}\n                <div class=\"tooltiptext px-1\">{{ mir.last_update }}</div>\n              </div>\n            </template>\n            <template v-else>\n              <div data-tuna-roll-seq=\"0 1\">\n                {{ mir.last_update_ago }}\n                <div class=\"tooltiptext px-1\">{{ mir.last_update }}</div>\n              </div>\n              <div\n                data-tuna-roll-seq=\"2 3\"\n                v-if=\"mir.last_ended_ts != mir.last_update_ts\"\n              >\n                {{ mir.last_ended_ago }}\n                <div class=\"tooltiptext px-1\">{{ mir.last_ended }}</div>\n              </div>\n            </template>\n            <div v-if=\"mir.status == 'syncing'\" data-tuna-roll-seq=\"4 5\">\n              {{ mir.last_started_ago }}\n              <div class=\"tooltiptext px-1\">{{ mir.last_started }}</div>\n            </div>\n            <div v-else data-tuna-roll-seq=\"4 5\">\n              {{ mir.next_schedule_ago }}\n              <div class=\"tooltiptext px-1\">{{ mir.next_schedule }}</div>\n            </div>\n          </div>\n        </td>\n        <th class=\"col-4 d-lg-none d-bs3-def-none text-end\">Upstream</th>\n        <td class=\"col-8 col-lg-4\">{{ mir.upstream }}</td>\n        <th class=\"col-4 d-lg-none d-bs3-def-none text-end\">Status</th>\n        <td class=\"col-8 col-lg-1\">{{ mir.status }}</td>\n        <th class=\"col-4 d-lg-none d-bs3-def-none text-end\">Size</th>\n        <td class=\"col-8 col-lg-1\">{{ mir.size }}</td>\n      </tr>\n    </tbody>\n  </table>\n</template>\n\n<style lang=\"scss\" scoped>\n@use \"sass:map\";\n@use \"../styles/sync-status.scss\";\n@use \"../styles/_bootstrap_vars.scss\" as bs;\n\ntable {\n  & > tbody > tr {\n    border-bottom-width: var(--bs-border-width);\n  }\n\n  & > thead > tr {\n    border-bottom-width: calc(var(--bs-border-width) * 2);\n    border-bottom-style: solid;\n    border-bottom-color: currentColor;\n  }\n}\n\n.tuna-roll {\n  position: relative;\n  overflow: hidden;\n\n  > div {\n    position: absolute;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    top: 0;\n\n    animation-timing-function: ease;\n    animation-duration: 1s;\n    animation-iteration-count: 1;\n\n    /* Tooltip text */\n    > .tooltiptext {\n      visibility: hidden;\n      width: auto;\n      background-color: #555;\n      color: #fff;\n      text-align: center;\n      border-radius: 5px;\n\n      /* Position the tooltip text - see examples below! */\n      position: absolute;\n      top: 0;\n      left: 0;\n      z-index: 1;\n    }\n\n    &:hover > .tooltiptext {\n      visibility: visible;\n    }\n  }\n\n  @keyframes tuna-roll-enter {\n    0% {\n      transform: translateY(100%);\n    }\n\n    100% {\n      transform: none;\n    }\n  }\n\n  @keyframes tuna-roll-leave {\n    0% {\n      transform: none;\n    }\n\n    100% {\n      transform: translateY(-100%);\n    }\n  }\n}\n\n@each $attrib in (\"[data-tuna-roll-cur\", \".row[data-tuna-roll-freeze\") {\n  @for $i from 0 to 7 {\n    #{$attrib}=\"#{$i}\"] {\n      .tuna-roll > div {\n        animation-name: tuna-roll-leave;\n        transform: translateY(100%);\n      }\n\n      .tuna-roll > div[data-tuna-roll-seq~=\"#{$i}\"] {\n        animation-name: tuna-roll-enter;\n        transform: none;\n      }\n    }\n  }\n}\n\n@media (prefers-reduced-motion) {\n  .d-reduce-none {\n    display: none !important;\n  }\n  @media (min-width: map.get(bs.$grid-breakpoints, \"lg\")) {\n    .d-lg-reduce-table-cell {\n      display: table-cell !important;\n    }\n  }\n}\n</style>\n","import \"./default\";\n\nimport DiskBar from \"../components/DiskBar.vue\";\nimport StatusMirrorList from \"../components/StatusMirrorList.vue\";\nimport { createApp } from \"vue\";\n\ncreateApp(DiskBar).mount(\"#disk-usage\");\ncreateApp(StatusMirrorList).mount(\"#mirror-list\");\n"],"names":["diskUsages","ref","readableFileSize","size","units","i","toFixed","onMounted","_asyncToGenerator","_regeneratorRuntime","mark","_callee","res","d","wrap","_callee$","_context","prev","next","fetch","DISKINFO_JSON_PATH","sent","json","Array","isArray","_readOnlyError","value","map","disk","percentage","Math","round","used_kb","total_kb","desc","used","total","_percentage","nextTick","Promise","resolve","setTimeout","forEach","stop","rollMax","SCROLL_INTERVAL","rawMirrorList","useMirrorList","rollCur","doScroll","freezedRows","setInterval","createApp","DiskBar","mount","StatusMirrorList"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAIM,IAAAA,UAAA,GAAaC,GAAI,CAAA,EAAE,CAAA;YAEnB,IAAAC,gBAAA,GAAmB,SAAnBA,gBAAAA,CAAoBC,IAAS,EAAA;cAC7B,IAAAC,KAAA,GAAQ,CAAC,GAAA,EAAK,IAAM,EAAA,IAAA,EAAM,MAAM,IAAM,EAAA,IAAA,EAAM,IAAM,EAAA,IAAA,EAAM,IAAI,CAAA;cAChE,IAAIC,CAAI,GAAA,CAAA;cACR,OAAOF,QAAQ,IAAM,EAAA;gBACXA,IAAA,IAAA,IAAA;gBACN,EAAAE,CAAA;cACJ;cACA,OAAOF,KAAKG,OAAQ,CAAA,CAAC,CAAI,GAAA,GAAA,GAAMF,MAAMC,CAAC,CAAA;YAAA,CACxC;YAEAE,SAAA,eAAAC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAAU,SAAAC,QAAA;cAAA,IAAAC,GAAA,EAAAC,CAAA;cAAA,OAAAJ,mBAAA,GAAAK,IAAA,UAAAC,SAAAC,QAAA;gBAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;kBAAA;oBAAAF,QAAA,CAAAE,IAAA;oBAAA,OACUC,KAAA,CAAMC,kBAAkB,CAAA;kBAAA;oBAApCR,GAAA,GAAAI,QAAA,CAAAK,IAAA;oBAAAL,QAAA,CAAAE,IAAA;oBAAA,OACUN,GAAA,CAAIU,IAAK,EAAA;kBAAA;oBAAnBT,CAAA,GAAAG,QAAA,CAAAK,IAAA;oBACN,IAAI,CAACE,KAAA,CAAMC,OAAQ,CAAAX,CAAC,CAAG,EAAA;sBACjB,CAACA,CAAC,CAAA,EAAAY,cAAA;oBACR;oBACAzB,UAAA,CAAW0B,KAAQ,GAAAb,CAAA,CAAEc,GAAI,CAAA,UAACC,IAAS,EAAA;sBACjC,IAAMC,aAAaC,IAAK,CAAAC,KAAA,CAAOH,KAAKI,OAAU,GAAA,GAAA,GAAOJ,KAAKK,QAAQ,CAAA;sBAC3D,OAAA;wBACLC,MAAMN,IAAK,CAAAM,IAAA;wBACXC,IAAM,EAAAjC,gBAAA,CAAiB0B,IAAK,CAAAI,OAAA,GAAU,IAAI,CAAA;wBAC1CI,KAAO,EAAAlC,gBAAA,CAAiB0B,IAAK,CAAAK,QAAA,GAAW,IAAI,CAAA;wBAC5CJ,UAAA,EAAY,OAAyBA,UAAa,GAAA,CAAA;wBAClDQ,WAAa,EAAAR;sBAAA,CACf;oBAAA,CACD,CAAA;oBAAA;sBAAAb,QAAA,CAAAE,IAAA;sBAAA;oBAAA;oBAAAF,QAAA,CAAAE,IAAA;oBAAA,OAEOoB,QAAS,CAAA,CAAA;kBAAA;oBAAAtB,QAAA,CAAAE,IAAA;oBAAA,OACT,IAAIqB,OAAA,CAAQ,UAACC,OACjB;sBAAA,OAAAC,UAAA,CAAW,YAAM;wBACPD,OAAA,EAAA;yBACP,CAAC,CAAA;oBAAA,CAAA,CACN;kBAAA;oBACWxC,UAAA,CAAA0B,KAAA,CAAMgB,OAAQ,CAAA,UAACd,IAAS,EAAA;sBACjCA,IAAA,CAAKC,aAAaD,IAAK,CAAAS,WAAA;oBAAA,CACxB,CAAA;kBAAA;kBAAA;oBAAA,OAAArB,QAAA,CAAA2B,IAAA;gBAAA;cAAA,GAAAhC,OAAA;YAAA,CAEJ,GAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QCrCD,IAAMiC,OAAO,GAAG,CAAC;QAGjB,IAAMC,eAAe,GAAG,IAAI;;;;YAL5B,IAAMC,aAAa,GAAGC,aAAa,CAAA,CAAE;YAGrC,IAAMC,OAAO,GAAG/C,GAAG,CAAC,CAAC,CAAC;YAGtB,IAAMgD,QAAQ,GAAG,SAAXA,QAAQA,CAAA,EAAe;cAC3BD,OAAO,CAACtB,KAAK,IAAI,CAAC;cAClB,IAAIsB,OAAO,CAACtB,KAAK,IAAIkB,OAAO,EAAEI,OAAO,CAACtB,KAAK,GAAG,CAAC;YACjD,CAAC;YAED,IAAMwB,WAAW,GAAGjD,GAAG,CAAC,CAAA,CAAE,CAAC;YAE3BM,SAAS,CAAC,YAAM;cACd4C,WAAW,CAACF,QAAQ,EAAEJ,eAAe,CAAC;YACxC,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QCbFO,SAAU,CAAAC,WAAO,CAAE,CAAAC,KAAA,CAAM,aAAa,CAAA;QACtCF,SAAU,CAAAG,gBAAgB,CAAE,CAAAD,KAAA,CAAM,cAAc,CAAA;;;;"}